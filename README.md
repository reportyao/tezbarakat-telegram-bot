'''
# Tezbarakat Telegram 智能营销机器人

这是一个功能强大的 Telegram 智能营销机器人系统，专为塔吉克斯坦金融市场设计。它能够监控多个 Telegram 群组，通过关键词和 Dify AI 意图分析，自动识别潜在客户，并进行智能化的群内回复和私信跟进，最终将商机无缝对接到销售团队。

## 系统架构

系统采用现代化的微服务架构，各个模块独立部署、易于扩展，确保了高可用性和高性能。

![系统架构图](architecture.png)

- **Web 前端 (React/Vite)**: 提供一个美观、易用的管理后台，用于监控机器人状态、管理账号、群组、关键词和查看消息记录。
- **Web 后台 (Python/FastAPI)**: 作为系统的“大脑”，提供 RESTful API 接口供前端调用，并控制和协调其他服务。
- **Telegram 核心服务 (Python/Telethon)**: 系统的“感官”和“手臂”，负责连接和操作多个 Telegram 账号，实时监听群组消息，并执行回复和私信任务。
- **PostgreSQL 数据库**: 持久化存储所有业务数据，包括账号、群组、消息、用户、配置等。
- **Dify 自部署服务**: 提供强大的 AI 能力，用于自然语言理解（NLU），分析消息意图，并驱动更智能的对话策略。
- **Nginx**: 作为反向代理，统一 API 入口，并处理静态文件请求。

## 核心功能

- **多群组监控**: 可同时监控多达100个目标群组，不错过任何一个潜在商机。
- **多账号轮换**: 支持最多20个 Telegram 小号轮换执行任务，有效规避平台风控，保证业务连续性。
- **双层触发引擎**:
  - **关键词匹配**: 快速响应包含预设关键词（如“贷款”、“借钱”）的消息。
  - **Dify AI 意图分析**: 通过大语言模型分析消息语义，精准识别潜在的贷款需求，即使没有明确的关键词。
- **双层回复策略**:
  - **群内@回复**: 在群内以友好的方式简单互动，吸引用户注意。
  - **自动私信**: 立即向潜在客户发送详细的产品介绍，开启一对一沟通。
- **持续对话能力**: 集成 Dify 知识库，能够与用户进行多轮私信对话，解答常见问题。
- **精细化风控**:
  - **发送间隔控制**: 模拟真人行为，随机化消息发送间隔。
  - **用户冷却机制**: 避免在短时间内重复打扰同一用户。
  - **每日/每小时发送上限**: 限制单个账号的发送量，降低封号风险。
  - **活跃时段设置**: 让机器人在指定的时间段内工作，更符合真人习惯。
- **可视化管理后台**:
  - **实时仪表盘**: 动态展示核心业务指标，如监控消息数、触发数、回复数等。
  - **账号/群组/关键词管理**: 方便地增删改查所有核心配置。
  - **消息/用户记录**: 详细记录所有交互历史，便于分析和复盘。
  - **实时日志**: 通过 WebSocket 实时查看系统运行日志，快速定位问题。
  - **系统配置中心**: 在线调整所有业务参数，无需重启服务。

## 部署指南

系统采用 Docker Compose 进行容器化部署，极大地简化了部署流程。

### 先决条件

- 一台安装了 Docker 和 Docker Compose 的 Linux 服务器。
- 一个自部署的 Dify 服务实例。
- 一个域名（可选，用于 HTTPS）。

### 部署步骤

1. **克隆项目**
   ```bash
   git clone <your-repo-url>
   cd tezbarakat_bot
   ```

2. **配置环境变量**
   根据 `.env.example` 文件创建 `.env` 文件，并填入所有必要的配置信息，包括：
   - 数据库连接信息
   - Dify API 地址和密钥
   - 管理后台的初始用户名和密码
   - JWT 密钥等

3. **初始化数据库**
   将 `database/init.sql` 导入到你的 PostgreSQL 数据库中。

4. **启动服务**
   ```bash
   sudo docker-compose up -d
   ```

5. **访问管理后台**
   通过浏览器访问 `http://<your-server-ip>:8080`，使用您在 `.env` 文件中配置的管理员账号登录。

6. **配置机器人**
   - **系统配置**: 登录后，进入“系统配置”页面，检查并保存所有参数。
   - **添加账号**: 进入“账号管理”，添加用于执行任务的 Telegram 小号，并完成登录验证。
   - **添加群组**: 进入“群组管理”，添加需要监控的目标群组。
   - **添加关键词**: 进入“关键词管理”，添加用于触发回复的关键词。

7. **启动机器人**
   在仪表盘页面，点击“启动”按钮，机器人将开始工作。

## 技术栈

| 模块 | 技术 | 主要库/框架 |
| :--- | :--- | :--- |
| **前端** | TypeScript, React | Vite, TailwindCSS, Zustand, React Query, Recharts |
| **后端** | Python | FastAPI, SQLAlchemy, Pydantic, Uvicorn |
| **Bot核心** | Python | Telethon, APScheduler |
| **数据库** | PostgreSQL | - |
| **AI服务** | Dify | - |
| **部署** | Docker | Docker Compose, Nginx |

## 项目结构

```
/home/ubuntu/tezbarakat_bot
├── bot_core/             # Telegram Bot 核心服务
├── database/             # 数据库脚本
├── dify/                 # Dify 工作流和提示词模板
├── web_backend/          # FastAPI 后端服务
├── web_frontend/         # React 前端应用
├── .env.example          # 环境变量示例
├── docker-compose.yml    # Docker Compose 部署文件
└── README.md             # 项目说明文档
```

## 荣誉出品

**Manus AI** - 为荣誉而战！
'''
