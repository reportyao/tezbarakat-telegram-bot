# Dify 工作流配置指南

本目录包含 Tezbarakat Telegram Bot 所需的 Dify 工作流配置文件和提示词模板。

## 概述

系统需要两个 Dify 工作流：

1. **意图分析工作流** - 分析群组消息，判断是否为商机
2. **知识库对话工作流** - 处理私信对话，提供产品咨询

## 工作流 1：意图分析

### 功能说明

分析用户在群组中发送的消息，判断是否表达了贷款需求或相关意图。

### 输入参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| message | string | 用户发送的消息文本 |
| user_id | string | 用户 Telegram ID |
| username | string | 用户名（可选） |

### 输出参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| is_opportunity | boolean | 是否为商机 |
| confidence | number | 置信度 (0-1) |
| category | string | 意图分类 |
| group_reply | string | 群内回复文本 |
| private_reply | string | 私信回复文本 |

### 配置步骤

1. 在 Dify 中创建新的工作流应用
2. 添加 LLM 节点，使用以下系统提示词
3. 配置输入输出变量
4. 发布工作流并获取 API 密钥

## 工作流 2：知识库对话

### 功能说明

基于知识库回答用户的私信咨询，提供产品信息和服务介绍。

### 输入参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| message | string | 用户发送的消息 |

### 配置步骤

1. 在 Dify 中创建知识库，上传产品文档
2. 创建聊天应用，关联知识库
3. 配置对话提示词
4. 发布应用并获取 API 密钥

## 文件说明

- `intent_analysis_prompt.md` - 意图分析系统提示词
- `knowledge_chat_prompt.md` - 知识库对话系统提示词
- `sample_knowledge.md` - 知识库示例内容

## 部署注意事项

1. 确保 Dify 服务已正确部署
2. 配置 API 访问权限
3. 在 Bot 配置中填入正确的 API 地址和密钥
4. 测试工作流连接是否正常
